{% extends "base.html" %}
{% block content %}
<h4 class="mb-4 text-center" style="color: #1b33a9;">Step 1 — App Overview</h4>

<form method="POST" class="needs-validation bg-white p-4 rounded shadow-sm" novalidate>
  
  <!-- 1. Core Problem Statement -->
  <div class="mb-4">
    <label for="core_problem" class="form-label fw-semibold">What problem does your app solve?</label>
    <textarea name="core_problem_statement" id="core_problem" class="form-control" rows="3" required
      placeholder="Example: Small shop owners struggle to track daily sales and expenses efficiently.">{{ core_problem_statement }}</textarea>
    <div class="form-text">Be specific about the pain point your app addresses.</div>
  </div>

  <!-- 2. Who are your main users? -->
  <div class="mb-4">
    <label class="form-label fw-semibold">Who are your main users? (Select all that apply)</label>
    <select name="user_role_segment" id="user_role_segment" class="form-select multi-select" multiple required>
      <optgroup label="Individuals / Consumers">
        <option value="Students">Students</option>
        <option value="Teachers/Educators">Teachers / Educators</option>
        <option value="Parents">Parents</option>
        <option value="Job Seekers">Job Seekers</option>
        <option value="Gamers">Gamers</option>
        <option value="Fitness Enthusiasts">Fitness Enthusiasts</option>
        <option value="Travelers">Travelers</option>
        <option value="Content Creators">Content Creators / Influencers</option>
        <option value="General Consumers">General Consumers (B2C)</option>
      </optgroup>

      <optgroup label="Businesses / Organizations">
        <option value="Small Business Owners">Small Business Owners (SMB)</option>
        <option value="Startups">Startups</option>
        <option value="Freelancers/Contractors">Freelancers / Independent Professionals</option>
        <option value="Mid-Market Companies">Mid-Market Companies</option>
        <option value="Enterprises">Enterprises / Corporates</option>
        <option value="Agencies">Marketing / Design / Tech Agencies</option>
        <option value="E-Commerce Stores">E-Commerce Stores</option>
        <option value="Healthcare Providers">Healthcare / Clinics</option>
        <option value="Educational Institutions">Schools / Universities</option>
        <option value="Non-Profit/Government">Non-Profit / Government</option>
        <option value="Developers/Technical Users">Developers / Technical Users</option>
      </optgroup>

      <option value="Other_User">Other...</option>
    </select>

    <input type="text" name="user_role_segment_other" id="user_role_segment_other"
           class="form-control mt-2 d-none" placeholder="Specify other user segment...">
    <div class="form-text">Select all applicable audiences or type your own.</div>
  </div>

  <!-- 3. How will your app earn money? -->
  <div class="mb-4">
    <label class="form-label fw-semibold">How will your app earn money? (Select all that apply)</label>
    <select name="monetization_model" id="monetization_model" class="form-select multi-select" multiple required>
      <optgroup label="Direct Revenue Models">
        <option value="Subscription">Subscription (Monthly / Yearly)</option>
        <option value="One-Time Purchase">One-Time Purchase / License</option>
        <option value="Freemium">Freemium (Free plan + Paid upgrade)</option>
        <option value="In-App Purchases">In-App Purchases (IAP)</option>
        <option value="Pay-Per-Use / Credits">Pay-Per-Use / Credit System</option>
      </optgroup>

      <optgroup label="Indirect / Partnership Models">
        <option value="Advertising">Advertising / Sponsorships</option>
        <option value="Affiliate Marketing">Affiliate Marketing</option>
        <option value="Lead Generation">Lead Generation / Referrals</option>
        <option value="Commission / Transaction Fee">Commission / Marketplace Fee</option>
        <option value="Crowdfunding">Crowdfunding / Donations</option>
      </optgroup>

      <optgroup label="Enterprise / B2B Models">
        <option value="White-Label Licensing">White-Label Licensing</option>
        <option value="Custom Solutions">Custom Enterprise Solutions</option>
        <option value="API / Data Licensing">API Access / Data Licensing</option>
        <option value="SaaS Model">SaaS Model (Recurring B2B sales)</option>
        <option value="Hardware Bundling">Bundled with Hardware Product</option>
      </optgroup>

      <option value="Other_Money">Other...</option>
    </select>

    <input type="text" name="monetization_model_other" id="monetization_model_other"
           class="form-control mt-2 d-none" placeholder="Specify other revenue model...">
    <div class="form-text">Choose one or more revenue streams or type your own.</div>
  </div>

  <div class="text-end mt-5">
    <button type="submit" class="btn btn-primary px-4" style="background-color:#1b33a9;border-color:#1b33a9;">Next →</button>
  </div>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const userSelect = document.getElementById('user_role_segment');
  const userOtherInput = document.getElementById('user_role_segment_other');
  const moneySelect = document.getElementById('monetization_model');
  const moneyOtherInput = document.getElementById('monetization_model_other');

  function handleOther(selectEl, inputEl, matchValue) {
    const selected = Array.from(selectEl.selectedOptions).map(o => o.value);
    if (selected.includes(matchValue)) {
      inputEl.classList.remove('d-none');
      inputEl.required = true;
    } else {
      inputEl.classList.add('d-none');
      inputEl.required = false;
      inputEl.value = '';
    }
  }

  userSelect.addEventListener('change', () => handleOther(userSelect, userOtherInput, 'Other_User'));
  moneySelect.addEventListener('change', () => handleOther(moneySelect, moneyOtherInput, 'Other_Money'));

  // Pre-populate saved data
  const storedUser = "{{ user_role_segment | default('') }}".split(', ');
  const storedMoney = "{{ monetization_model | default('') }}".split(', ');

  storedUser.forEach(val => {
    if (!val) return;
    const opt = userSelect.querySelector(`option[value="${val}"]`);
    if (opt) opt.selected = true;
    else userSelect.add(new Option(val, val, true, true));
  });

  storedMoney.forEach(val => {
    if (!val) return;
    const opt = moneySelect.querySelector(`option[value="${val}"]`);
    if (opt) opt.selected = true;
    else moneySelect.add(new Option(val, val, true, true));
  });

  handleOther(userSelect, userOtherInput, 'Other_User');
  handleOther(moneySelect, moneyOtherInput, 'Other_Money');

  // Merge custom 'Other' values before submit
  document.querySelector('form').addEventListener('submit', () => {
    if (userSelect.value.includes('Other_User') && userOtherInput.value.trim()) {
      userSelect.add(new Option(userOtherInput.value.trim(), userOtherInput.value.trim(), true, true));
    }
    if (moneySelect.value.includes('Other_Money') && moneyOtherInput.value.trim()) {
      moneySelect.add(new Option(moneyOtherInput.value.trim(), moneyOtherInput.value.trim(), true, true));
    }
  });
});
</script>
{% endblock %}
